import{j as e,r as l,a as j}from"./index-Cvj7fk6O.js";const b=({path:o,onClick:d,onEnter:n,onLeave:r})=>e.jsx("div",{className:"a_photo",onClick:d,onMouseEnter:n,onMouseLeave:r,children:e.jsx("img",{src:o})}),w=({images:o,setImages:d})=>{const[n,r]=l.useState(null),[u,i]=l.useState(null),[m,c]=l.useState(null);l.useEffect(()=>{if(!n){i(null);return}const t=URL.createObjectURL(n);return i(t),()=>URL.revokeObjectURL(t)},[n]);const g=t=>{if(!t.target.files||t.target.files.length===0){r(null);return}const a=t.target.files[0];console.log("file obj",a),r(a),p(a)},p=t=>{const a=new FileReader;a.onload=f=>{const h=new Image;h.onload=()=>{console.log("metadata bitch",Object.keys(t),"file",t);const v={name:t.name,type:t.type,size:t.size,shot:new Date(t.lastModified).toLocaleString(),dimensions:`${h.width}x${h.height}`};c(v)},h.src=f.target.result},a.readAsDataURL(t)},x=()=>{c(null),i(null),r(null)},s=async()=>{if(!n)return;const t=new FormData;t.append("image",n),t.append("info",JSON.stringify(m));try{const a=await j.post("/api/upload",t,{headers:{"Content-Type":"multipart/form-data"}});d(o.concat(a.data)),console.log("Image uploaded successfully:",a.data),c(null),i(null),r(null)}catch(a){console.error("Error uploading image:",a)}};return e.jsxs("div",{id:"image_uploader",children:[e.jsx("input",{id:"browse_button",type:"file",accept:"image/*",onChange:g}),e.jsx("label",{id:"browse_label",htmlFor:"browse_button",children:"add image?"}),e.jsxs("div",{id:"previews",children:[u&&e.jsxs("div",{id:"preview_box",children:[e.jsx("h3",{children:"Preview:"}),console.log("src",u),e.jsx("img",{src:u,alt:"Preview",style:{maxWidth:"300px"}})]}),m&&e.jsxs("div",{id:"metadata_box",children:[e.jsx("h3",{children:"Metadata:"}),e.jsx("ul",{children:Object.entries(m).map(([t,a])=>e.jsxs("li",{children:[e.jsxs("strong",{children:[t,":"]})," ",a]},t))})]})]}),n&&e.jsxs("div",{id:"upload_buttons",children:[e.jsx("button",{className:"upload_button",onClick:x,children:"Cancel"}),e.jsx("button",{className:"upload_button",onClick:s,children:"Upload Image"})]})]})},_=()=>{const[o,d]=l.useState([]),[n,r]=l.useState(null),[u,i]=l.useState(null),[m,c]=l.useState(!1);l.useEffect(()=>{(async()=>{try{const t=await j.get("/api/imagelist");d(t.data)}catch(t){console.error("Error fetching images:",t)}})()},[]),l.useEffect(()=>{o.length>0&&r(o[0]);const s=Math.floor(Math.sqrt(o.length));document.documentElement.style.setProperty("--grid-column-count",s)},[o]);const g=s=>()=>{r(s)},p=s=>()=>{c(!1),i(s)},x=()=>{i(null)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{id:"gallery",className:"main_app",children:[e.jsx("div",{id:"carousel",children:o.map((s,t)=>e.jsx(b,{path:s.path,onClick:g(s),onEnter:p(s.path),onLeave:x},t))}),e.jsx("div",{id:"main_image",onMouseEnter:()=>c(!0),onMouseLeave:()=>c(!1),children:n&&e.jsxs(e.Fragment,{children:[e.jsx("img",{src:u||n.path}),e.jsx("div",{id:m?"image_info":"dont_show",children:e.jsx("p",{children:n.info.includes("{")?e.jsx(e.Fragment,{children:Object.entries(JSON.parse(n.info)).map(([s,t])=>e.jsxs("p",{children:[s,": ",t]},s))}):n.info})})]})})]}),e.jsx(w,{images:o,setImages:d})]})};export{_ as default};
