import{b as fe,c as Pe,g as Re,j as e,r as _}from"./index-DmwwieFe.js";var oe={},D={},ie={},Se;function P(){return Se||(Se=1,function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.isEventSourceSupported=r.isReactNative=r.ReadyState=r.DEFAULT_HEARTBEAT=r.UNPARSABLE_JSON_OBJECT=r.DEFAULT_RECONNECT_INTERVAL_MS=r.DEFAULT_RECONNECT_LIMIT=r.SOCKET_IO_PING_CODE=r.SOCKET_IO_PATH=r.SOCKET_IO_PING_INTERVAL=r.DEFAULT_EVENT_SOURCE_OPTIONS=r.EMPTY_EVENT_HANDLERS=r.DEFAULT_OPTIONS=void 0;var f=1,v=1e3*f;r.DEFAULT_OPTIONS={},r.EMPTY_EVENT_HANDLERS={},r.DEFAULT_EVENT_SOURCE_OPTIONS={withCredentials:!1,events:r.EMPTY_EVENT_HANDLERS},r.SOCKET_IO_PING_INTERVAL=25*v,r.SOCKET_IO_PATH="/socket.io/?EIO=3&transport=websocket",r.SOCKET_IO_PING_CODE="2",r.DEFAULT_RECONNECT_LIMIT=20,r.DEFAULT_RECONNECT_INTERVAL_MS=5e3,r.UNPARSABLE_JSON_OBJECT={},r.DEFAULT_HEARTBEAT={message:"ping",timeout:6e4,interval:25e3};var S;(function(h){h[h.UNINSTANTIATED=-1]="UNINSTANTIATED",h[h.CONNECTING=0]="CONNECTING",h[h.OPEN=1]="OPEN",h[h.CLOSING=2]="CLOSING",h[h.CLOSED=3]="CLOSED"})(S||(r.ReadyState=S={}));var d=function(){try{return"EventSource"in globalThis}catch{return!1}};r.isReactNative=typeof navigator<"u"&&navigator.product==="ReactNative",r.isEventSourceSupported=!r.isReactNative&&d()}(ie)),ie}var Z={},ue={},ye;function he(){return ye||(ye=1,function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.resetWebSockets=r.sharedWebSockets=void 0,r.sharedWebSockets={};var f=function(v){if(v&&r.sharedWebSockets.hasOwnProperty(v))delete r.sharedWebSockets[v];else for(var S in r.sharedWebSockets)r.sharedWebSockets.hasOwnProperty(S)&&delete r.sharedWebSockets[S]};r.resetWebSockets=f}(ue)),ue}var J={},W={},xe;function ve(){if(xe)return W;xe=1,Object.defineProperty(W,"__esModule",{value:!0}),W.setUpSocketIOPing=W.appendQueryParams=W.parseSocketIOUrl=void 0;var r=P(),f=function(d){if(d){var h=/^https|wss/.test(d),g=d.replace(/^(https?|wss?)(:\/\/)?/,""),m=g.replace(/\/$/,""),u=h?"wss":"ws";return"".concat(u,"://").concat(m).concat(r.SOCKET_IO_PATH)}else if(d===""){var h=/^https/.test(window.location.protocol),u=h?"wss":"ws",l=window.location.port?":".concat(window.location.port):"";return"".concat(u,"://").concat(window.location.hostname).concat(l).concat(r.SOCKET_IO_PATH)}return d};W.parseSocketIOUrl=f;var v=function(d,h){h===void 0&&(h={});var g=/\?([\w]+=[\w]+)/,m=g.test(d),u="".concat(Object.entries(h).reduce(function(l,c){var t=c[0],o=c[1];return l+"".concat(t,"=").concat(o,"&")},"").slice(0,-1));return"".concat(d).concat(m?"&":"?").concat(u)};W.appendQueryParams=v;var S=function(d,h){h===void 0&&(h=r.SOCKET_IO_PING_INTERVAL);var g=function(){return d(r.SOCKET_IO_PING_CODE)};return window.setInterval(g,h)};return W.setUpSocketIOPing=S,W}var ae={},pe;function De(){if(pe)return ae;pe=1,Object.defineProperty(ae,"__esModule",{value:!0}),ae.heartbeat=f;var r=P();function f(v,S,d){var h=d||{},g=h.interval,m=g===void 0?r.DEFAULT_HEARTBEAT.interval:g,u=h.timeout,l=u===void 0?r.DEFAULT_HEARTBEAT.timeout:u,c=h.message,t=c===void 0?r.DEFAULT_HEARTBEAT.message:c,o=setInterval(function(){if(S.current+l<=Date.now())console.warn("Heartbeat timed out, closing connection, last message was seen ".concat(Date.now()-S.current,"ms ago")),v.close();else if(S.current+m<=Date.now())try{typeof t=="function"?v.send(t()):v.send(t)}catch(a){console.error("Heartbeat failed, closing connection",a instanceof Error?a.message:a),v.close()}},m);return v.addEventListener("close",function(){clearInterval(o)}),function(){}}return ae}var ee={},le={},we;function ge(){return we||(we=1,function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.resetSubscribers=r.removeSubscriber=r.addSubscriber=r.hasSubscribers=r.getSubscribers=void 0;var f={},v=[],S=function(u){return(0,r.hasSubscribers)(u)?Array.from(f[u]):v};r.getSubscribers=S;var d=function(u){var l;return((l=f[u])===null||l===void 0?void 0:l.size)>0};r.hasSubscribers=d;var h=function(u,l){f[u]=f[u]||new Set,f[u].add(l)};r.addSubscriber=h;var g=function(u,l){f[u].delete(l)};r.removeSubscriber=g;var m=function(u){if(u&&f.hasOwnProperty(u))delete f[u];else for(var l in f)f.hasOwnProperty(l)&&delete f[l]};r.resetSubscribers=m}(le)),le}var je;function be(){if(je)return ee;je=1,Object.defineProperty(ee,"__esModule",{value:!0}),ee.assertIsWebSocket=v,ee.resetGlobalState=S;var r=he(),f=ge();function v(d,h){if(!h&&!(d instanceof WebSocket))throw new Error("")}function S(d){(0,f.resetSubscribers)(d),(0,r.resetWebSockets)(d)}return ee}var Ee;function We(){if(Ee)return J;Ee=1;var r=J&&J.__assign||function(){return r=Object.assign||function(c){for(var t,o=1,a=arguments.length;o<a;o++){t=arguments[o];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(c[n]=t[n])}return c},r.apply(this,arguments)};Object.defineProperty(J,"__esModule",{value:!0}),J.attachListeners=void 0;var f=ve(),v=De(),S=P(),d=be(),h=function(c,t,o,a){c.onmessage=function(n){var i;t.current.onMessage&&t.current.onMessage(n),typeof(a==null?void 0:a.current)=="number"&&(a.current=Date.now()),!(typeof t.current.filter=="function"&&t.current.filter(n)!==!0)&&(t.current.heartbeat&&typeof t.current.heartbeat!="boolean"&&((i=t.current.heartbeat)===null||i===void 0?void 0:i.returnMessage)===n.data||o(n))}},g=function(c,t,o,a,n){c.onopen=function(i){if(t.current.onOpen&&t.current.onOpen(i),a.current=0,o(S.ReadyState.OPEN),t.current.heartbeat&&c instanceof WebSocket){var b=typeof t.current.heartbeat=="boolean"?void 0:t.current.heartbeat;n.current=Date.now(),(0,v.heartbeat)(c,n,b)}}},m=function(c,t,o,a,n){if(S.isEventSourceSupported&&c instanceof EventSource)return function(){};(0,d.assertIsWebSocket)(c,t.current.skipAssert);var i;return c.onclose=function(b){var s;if(t.current.onClose&&t.current.onClose(b),o(S.ReadyState.CLOSED),t.current.shouldReconnect&&t.current.shouldReconnect(b)){var y=(s=t.current.reconnectAttempts)!==null&&s!==void 0?s:S.DEFAULT_RECONNECT_LIMIT;if(n.current<y){var w=typeof t.current.reconnectInterval=="function"?t.current.reconnectInterval(n.current):t.current.reconnectInterval;i=window.setTimeout(function(){n.current++,a()},w??S.DEFAULT_RECONNECT_INTERVAL_MS)}else t.current.onReconnectStop&&t.current.onReconnectStop(y),console.warn("Max reconnect attempts of ".concat(y," exceeded"))}},function(){return i&&window.clearTimeout(i)}},u=function(c,t,o,a,n){var i;return c.onerror=function(b){var s;if(t.current.onError&&t.current.onError(b),S.isEventSourceSupported&&c instanceof EventSource&&(t.current.onClose&&t.current.onClose(r(r({},b),{code:1006,reason:"An error occurred with the EventSource: ".concat(b),wasClean:!1})),o(S.ReadyState.CLOSED),c.close()),t.current.retryOnError)if(n.current<((s=t.current.reconnectAttempts)!==null&&s!==void 0?s:S.DEFAULT_RECONNECT_LIMIT)){var y=typeof t.current.reconnectInterval=="function"?t.current.reconnectInterval(n.current):t.current.reconnectInterval;i=window.setTimeout(function(){n.current++,a()},y??S.DEFAULT_RECONNECT_INTERVAL_MS)}else t.current.onReconnectStop&&t.current.onReconnectStop(t.current.reconnectAttempts),console.warn("Max reconnect attempts of ".concat(t.current.reconnectAttempts," exceeded"))},function(){return i&&window.clearTimeout(i)}},l=function(c,t,o,a,n,i,b){var s=t.setLastMessage,y=t.setReadyState,w,O,x;return o.current.fromSocketIO&&(w=(0,f.setUpSocketIOPing)(b)),h(c,o,s,i),g(c,o,y,n,i),O=m(c,o,y,a,n),x=u(c,o,y,a,n),function(){y(S.ReadyState.CLOSING),O(),x(),c.close(),w&&clearInterval(w)}};return J.attachListeners=l,J}var V={},_e;function Ue(){if(_e)return V;_e=1;var r=V&&V.__assign||function(){return r=Object.assign||function(t){for(var o,a=1,n=arguments.length;a<n;a++){o=arguments[a];for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(t[i]=o[i])}return t},r.apply(this,arguments)};Object.defineProperty(V,"__esModule",{value:!0}),V.attachSharedListeners=void 0;var f=he(),v=P(),S=ge(),d=ve(),h=De(),g=function(t,o,a){t.onmessage=function(n){(0,S.getSubscribers)(o).forEach(function(i){var b;i.optionsRef.current.onMessage&&i.optionsRef.current.onMessage(n),typeof((b=i==null?void 0:i.lastMessageTime)===null||b===void 0?void 0:b.current)=="number"&&(i.lastMessageTime.current=Date.now()),!(typeof i.optionsRef.current.filter=="function"&&i.optionsRef.current.filter(n)!==!0)&&(a&&typeof a!="boolean"&&(a==null?void 0:a.returnMessage)===n.data||i.setLastMessage(n))})}},m=function(t,o,a){t.onopen=function(n){(0,S.getSubscribers)(o).forEach(function(i){i.reconnectCount.current=0,i.optionsRef.current.onOpen&&i.optionsRef.current.onOpen(n),i.setReadyState(v.ReadyState.OPEN),a&&t instanceof WebSocket&&(i.lastMessageTime.current=Date.now(),(0,h.heartbeat)(t,i.lastMessageTime,typeof a=="boolean"?void 0:a))})}},u=function(t,o){t instanceof WebSocket&&(t.onclose=function(a){(0,S.getSubscribers)(o).forEach(function(n){n.optionsRef.current.onClose&&n.optionsRef.current.onClose(a),n.setReadyState(v.ReadyState.CLOSED)}),delete f.sharedWebSockets[o],(0,S.getSubscribers)(o).forEach(function(n){var i;if(n.optionsRef.current.shouldReconnect&&n.optionsRef.current.shouldReconnect(a)){var b=(i=n.optionsRef.current.reconnectAttempts)!==null&&i!==void 0?i:v.DEFAULT_RECONNECT_LIMIT;if(n.reconnectCount.current<b){var s=typeof n.optionsRef.current.reconnectInterval=="function"?n.optionsRef.current.reconnectInterval(n.reconnectCount.current):n.optionsRef.current.reconnectInterval;setTimeout(function(){n.reconnectCount.current++,n.reconnect.current()},s??v.DEFAULT_RECONNECT_INTERVAL_MS)}else n.optionsRef.current.onReconnectStop&&n.optionsRef.current.onReconnectStop(n.optionsRef.current.reconnectAttempts),console.warn("Max reconnect attempts of ".concat(b," exceeded"))}})})},l=function(t,o){t.onerror=function(a){(0,S.getSubscribers)(o).forEach(function(n){n.optionsRef.current.onError&&n.optionsRef.current.onError(a),v.isEventSourceSupported&&t instanceof EventSource&&(n.optionsRef.current.onClose&&n.optionsRef.current.onClose(r(r({},a),{code:1006,reason:"An error occurred with the EventSource: ".concat(a),wasClean:!1})),n.setReadyState(v.ReadyState.CLOSED))}),v.isEventSourceSupported&&t instanceof EventSource&&t.close()}},c=function(t,o,a,n){var i;return a.current.fromSocketIO&&(i=(0,d.setUpSocketIOPing)(n)),g(t,o,a.current.heartbeat),u(t,o),m(t,o,a.current.heartbeat),l(t,o),function(){i&&clearInterval(i)}};return V.attachSharedListeners=c,V}var ke;function qe(){if(ke)return Z;ke=1,Object.defineProperty(Z,"__esModule",{value:!0}),Z.createOrJoinSocket=void 0;var r=he(),f=P(),v=We(),S=Ue(),d=ge(),h=function(m,u,l,c,t){return function(){if((0,d.removeSubscriber)(m,u),!(0,d.hasSubscribers)(m)){try{var o=r.sharedWebSockets[m];o instanceof WebSocket&&(o.onclose=function(a){l.current.onClose&&l.current.onClose(a),c(f.ReadyState.CLOSED)}),o.close()}catch{}t&&t(),delete r.sharedWebSockets[m]}}},g=function(m,u,l,c,t,o,a,n,i){if(!f.isEventSourceSupported&&c.current.eventSourceOptions)throw f.isReactNative?new Error("EventSource is not supported in ReactNative"):new Error("EventSource is not supported");if(c.current.share){var b=null;r.sharedWebSockets[u]===void 0?(r.sharedWebSockets[u]=c.current.eventSourceOptions?new EventSource(u,c.current.eventSourceOptions):new WebSocket(u,c.current.protocols),m.current=r.sharedWebSockets[u],l(f.ReadyState.CONNECTING),b=(0,S.attachSharedListeners)(r.sharedWebSockets[u],u,c,i)):(m.current=r.sharedWebSockets[u],l(r.sharedWebSockets[u].readyState));var s={setLastMessage:t,setReadyState:l,optionsRef:c,reconnectCount:a,lastMessageTime:n,reconnect:o};return(0,d.addSubscriber)(u,s),h(u,s,c,l,b)}else{if(m.current=c.current.eventSourceOptions?new EventSource(u,c.current.eventSourceOptions):new WebSocket(u,c.current.protocols),l(f.ReadyState.CONNECTING),!m.current)throw new Error("WebSocket failed to be created");return(0,v.attachListeners)(m.current,{setLastMessage:t,setReadyState:l},c,o.current,a,n,i)}};return Z.createOrJoinSocket=g,Z}var U={},Oe;function Ge(){return Oe||(Oe=1,function(r){var f=U&&U.__awaiter||function(u,l,c,t){function o(a){return a instanceof c?a:new c(function(n){n(a)})}return new(c||(c=Promise))(function(a,n){function i(y){try{s(t.next(y))}catch(w){n(w)}}function b(y){try{s(t.throw(y))}catch(w){n(w)}}function s(y){y.done?a(y.value):o(y.value).then(i,b)}s((t=t.apply(u,l||[])).next())})},v=U&&U.__generator||function(u,l){var c={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},t,o,a,n=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return n.next=i(0),n.throw=i(1),n.return=i(2),typeof Symbol=="function"&&(n[Symbol.iterator]=function(){return this}),n;function i(s){return function(y){return b([s,y])}}function b(s){if(t)throw new TypeError("Generator is already executing.");for(;n&&(n=0,s[0]&&(c=0)),c;)try{if(t=1,o&&(a=s[0]&2?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[s[0]&2,a.value]),s[0]){case 0:case 1:a=s;break;case 4:return c.label++,{value:s[1],done:!1};case 5:c.label++,o=s[1],s=[0];continue;case 7:s=c.ops.pop(),c.trys.pop();continue;default:if(a=c.trys,!(a=a.length>0&&a[a.length-1])&&(s[0]===6||s[0]===2)){c=0;continue}if(s[0]===3&&(!a||s[1]>a[0]&&s[1]<a[3])){c.label=s[1];break}if(s[0]===6&&c.label<a[1]){c.label=a[1],a=s;break}if(a&&c.label<a[2]){c.label=a[2],c.ops.push(s);break}a[2]&&c.ops.pop(),c.trys.pop();continue}s=l.call(u,c)}catch(y){s=[6,y],o=0}finally{t=a=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}},S=U&&U.__spreadArray||function(u,l,c){if(c||arguments.length===2)for(var t=0,o=l.length,a;t<o;t++)(a||!(t in l))&&(a||(a=Array.prototype.slice.call(l,0,t)),a[t]=l[t]);return u.concat(a||Array.prototype.slice.call(l))};Object.defineProperty(r,"__esModule",{value:!0}),r.getUrl=void 0;var d=ve(),h=P(),g=function(u){return new Promise(function(l){return window.setTimeout(l,u)})},m=function(u,l){for(var c=[],t=2;t<arguments.length;t++)c[t-2]=arguments[t];return f(void 0,S([u,l],c,!0),void 0,function(o,a,n){var i,b,s,y,w,O,x,p;return n===void 0&&(n=0),v(this,function(j){switch(j.label){case 0:if(typeof o!="function")return[3,10];j.label=1;case 1:return j.trys.push([1,3,,9]),[4,o()];case 2:return i=j.sent(),[3,9];case 3:return j.sent(),a.current.retryOnError?(b=(O=a.current.reconnectAttempts)!==null&&O!==void 0?O:h.DEFAULT_RECONNECT_LIMIT,n<b?(s=typeof a.current.reconnectInterval=="function"?a.current.reconnectInterval(n):a.current.reconnectInterval,[4,g(s??h.DEFAULT_RECONNECT_INTERVAL_MS)]):[3,5]):[3,7];case 4:return j.sent(),[2,(0,r.getUrl)(o,a,n+1)];case 5:return(p=(x=a.current).onReconnectStop)===null||p===void 0||p.call(x,n),[2,null];case 6:return[3,8];case 7:return[2,null];case 8:return[3,9];case 9:return[3,11];case 10:i=o,j.label=11;case 11:return y=a.current.fromSocketIO?(0,d.parseSocketIOUrl)(i):i,w=a.current.queryParams?(0,d.appendQueryParams)(y,a.current.queryParams):y,[2,w]}})})};r.getUrl=m}(U)),U}var de={},Ne;function He(){return Ne||(Ne=1,function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.websocketWrapper=void 0;var f=function(v,S){return new Proxy(v,{get:function(d,h){var g=d[h];return h==="reconnect"?S:typeof g=="function"?(console.error("Calling methods directly on the websocket is not supported at this moment. You must use the methods returned by useWebSocket."),function(){}):g},set:function(d,h,g){return/^on/.test(h)?(console.warn("The websocket's event handlers should be defined through the options object passed into useWebSocket."),!1):(d[h]=g,!0)}})};r.websocketWrapper=f,r.default=r.websocketWrapper}(de)),de}var Me;function me(){if(Me)return D;Me=1;var r=D&&D.__assign||function(){return r=Object.assign||function(o){for(var a,n=1,i=arguments.length;n<i;n++){a=arguments[n];for(var b in a)Object.prototype.hasOwnProperty.call(a,b)&&(o[b]=a[b])}return o},r.apply(this,arguments)},f=D&&D.__awaiter||function(o,a,n,i){function b(s){return s instanceof n?s:new n(function(y){y(s)})}return new(n||(n=Promise))(function(s,y){function w(p){try{x(i.next(p))}catch(j){y(j)}}function O(p){try{x(i.throw(p))}catch(j){y(j)}}function x(p){p.done?s(p.value):b(p.value).then(w,O)}x((i=i.apply(o,a||[])).next())})},v=D&&D.__generator||function(o,a){var n={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},i,b,s,y=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return y.next=w(0),y.throw=w(1),y.return=w(2),typeof Symbol=="function"&&(y[Symbol.iterator]=function(){return this}),y;function w(x){return function(p){return O([x,p])}}function O(x){if(i)throw new TypeError("Generator is already executing.");for(;y&&(y=0,x[0]&&(n=0)),n;)try{if(i=1,b&&(s=x[0]&2?b.return:x[0]?b.throw||((s=b.return)&&s.call(b),0):b.next)&&!(s=s.call(b,x[1])).done)return s;switch(b=0,s&&(x=[x[0]&2,s.value]),x[0]){case 0:case 1:s=x;break;case 4:return n.label++,{value:x[1],done:!1};case 5:n.label++,b=x[1],x=[0];continue;case 7:x=n.ops.pop(),n.trys.pop();continue;default:if(s=n.trys,!(s=s.length>0&&s[s.length-1])&&(x[0]===6||x[0]===2)){n=0;continue}if(x[0]===3&&(!s||x[1]>s[0]&&x[1]<s[3])){n.label=x[1];break}if(x[0]===6&&n.label<s[1]){n.label=s[1],s=x;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(x);break}s[2]&&n.ops.pop(),n.trys.pop();continue}x=a.call(o,n)}catch(p){x=[6,p],b=0}finally{i=s=0}if(x[0]&5)throw x[1];return{value:x[0]?x[1]:void 0,done:!0}}},S=D&&D.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(D,"__esModule",{value:!0}),D.useWebSocket=void 0;var d=fe(),h=Pe(),g=P(),m=qe(),u=Ge(),l=S(He()),c=be(),t=function(o,a,n){a===void 0&&(a=g.DEFAULT_OPTIONS),n===void 0&&(n=!0);var i=(0,d.useState)(null),b=i[0],s=i[1],y=(0,d.useState)({}),w=y[0],O=y[1],x=(0,d.useMemo)(function(){if(b)try{return JSON.parse(b.data)}catch{return g.UNPARSABLE_JSON_OBJECT}return null},[b]),p=(0,d.useRef)(null),j=(0,d.useRef)(null),T=(0,d.useRef)(function(){}),A=(0,d.useRef)(0),G=(0,d.useRef)(Date.now()),z=(0,d.useRef)([]),C=(0,d.useRef)(null),I=(0,d.useRef)(a);I.current=a;var Y=p.current&&w[p.current]!==void 0?w[p.current]:o!==null&&n===!0?g.ReadyState.CONNECTING:g.ReadyState.UNINSTANTIATED,$=a.queryParams?JSON.stringify(a.queryParams):null,L=(0,d.useCallback)(function(k,M){var R;if(M===void 0&&(M=!0),g.isEventSourceSupported&&j.current instanceof EventSource){console.warn("Unable to send a message from an eventSource");return}((R=j.current)===null||R===void 0?void 0:R.readyState)===g.ReadyState.OPEN?((0,c.assertIsWebSocket)(j.current,I.current.skipAssert),j.current.send(k)):M&&z.current.push(k)},[]),K=(0,d.useCallback)(function(k,M){M===void 0&&(M=!0),L(JSON.stringify(k),M)},[L]),se=(0,d.useCallback)(function(){return I.current.share!==!0||g.isEventSourceSupported&&j.current instanceof EventSource?j.current:(C.current===null&&j.current&&((0,c.assertIsWebSocket)(j.current,I.current.skipAssert),C.current=(0,l.default)(j.current,T)),C.current)},[]);return(0,d.useEffect)(function(){if(o!==null&&n===!0){var k,M=!1,R=!0,te=function(){return f(void 0,void 0,void 0,function(){var Q,H,re;return v(this,function(ne){switch(ne.label){case 0:return Q=p,[4,(0,u.getUrl)(o,I)];case 1:return Q.current=ne.sent(),p.current===null?(console.error("Failed to get a valid URL. WebSocket connection aborted."),p.current="ABORTED",(0,h.flushSync)(function(){return O(function(F){return r(r({},F),{ABORTED:g.ReadyState.CLOSED})})}),[2]):(H=function(F){M||(0,h.flushSync)(function(){return s(F)})},re=function(F){M||(0,h.flushSync)(function(){return O(function(ce){var X;return r(r({},ce),p.current&&(X={},X[p.current]=F,X))})})},R&&(k=(0,m.createOrJoinSocket)(j,p.current,re,I,H,T,A,G,L)),[2])}})})};return T.current=function(){M||(C.current&&(C.current=null),k==null||k(),te())},te(),function(){M=!0,R=!1,C.current&&(C.current=null),k==null||k(),s(null)}}else(o===null||n===!1)&&(A.current=0,O(function(Q){var H;return r(r({},Q),p.current&&(H={},H[p.current]=g.ReadyState.CLOSED,H))}))},[o,n,$,L]),(0,d.useEffect)(function(){Y===g.ReadyState.OPEN&&z.current.splice(0).forEach(function(k){L(k)})},[Y]),{sendMessage:L,sendJsonMessage:K,lastMessage:b,lastJsonMessage:x,readyState:Y,getWebSocket:se}};return D.useWebSocket=t,D}var B={},Le;function ze(){if(Le)return B;Le=1;var r=B&&B.__assign||function(){return r=Object.assign||function(m){for(var u,l=1,c=arguments.length;l<c;l++){u=arguments[l];for(var t in u)Object.prototype.hasOwnProperty.call(u,t)&&(m[t]=u[t])}return m},r.apply(this,arguments)};Object.defineProperty(B,"__esModule",{value:!0}),B.useSocketIO=void 0;var f=fe(),v=me(),S=P(),d={type:"empty",payload:null},h=function(m){if(!m||!m.data)return d;var u=m.data.match(/\[.*]/);if(!u)return d;var l=JSON.parse(u);return!Array.isArray(l)||!l[1]?d:{type:l[0],payload:l[1]}},g=function(m,u,l){u===void 0&&(u=S.DEFAULT_OPTIONS),l===void 0&&(l=!0);var c=(0,f.useMemo)(function(){return r(r({},u),{fromSocketIO:!0})},[]),t=(0,v.useWebSocket)(m,c,l),o=t.sendMessage,a=t.sendJsonMessage,n=t.lastMessage,i=t.readyState,b=t.getWebSocket,s=(0,f.useMemo)(function(){return h(n)},[n]);return{sendMessage:o,sendJsonMessage:a,lastMessage:s,lastJsonMessage:s,readyState:i,getWebSocket:b}};return B.useSocketIO=g,B}var q={},Te;function Fe(){if(Te)return q;Te=1;var r=q&&q.__assign||function(){return r=Object.assign||function(g){for(var m,u=1,l=arguments.length;u<l;u++){m=arguments[u];for(var c in m)Object.prototype.hasOwnProperty.call(m,c)&&(g[c]=m[c])}return g},r.apply(this,arguments)},f=q&&q.__rest||function(g,m){var u={};for(var l in g)Object.prototype.hasOwnProperty.call(g,l)&&m.indexOf(l)<0&&(u[l]=g[l]);if(g!=null&&typeof Object.getOwnPropertySymbols=="function")for(var c=0,l=Object.getOwnPropertySymbols(g);c<l.length;c++)m.indexOf(l[c])<0&&Object.prototype.propertyIsEnumerable.call(g,l[c])&&(u[l[c]]=g[l[c]]);return u};Object.defineProperty(q,"__esModule",{value:!0}),q.useEventSource=void 0;var v=fe(),S=me(),d=P(),h=function(g,m,u){m===void 0&&(m=d.DEFAULT_EVENT_SOURCE_OPTIONS);var l=m.withCredentials,c=m.events,t=f(m,["withCredentials","events"]);u===void 0&&(u=!0);var o=r(r({},t),{eventSourceOptions:{withCredentials:l}}),a=(0,v.useRef)(d.EMPTY_EVENT_HANDLERS);c&&(a.current=c);var n=(0,S.useWebSocket)(g,o,u),i=n.lastMessage,b=n.readyState,s=n.getWebSocket;return(0,v.useEffect)(function(){i!=null&&i.type&&Object.entries(a.current).forEach(function(y){var w=y[0],O=y[1];w===i.type&&O(i)})},[i]),{lastEvent:i,readyState:b,getEventSource:s}};return q.useEventSource=h,q}var Ce;function Je(){return Ce||(Ce=1,function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.resetGlobalState=r.useEventSource=r.ReadyState=r.useSocketIO=r.default=void 0;var f=me();Object.defineProperty(r,"default",{enumerable:!0,get:function(){return f.useWebSocket}});var v=ze();Object.defineProperty(r,"useSocketIO",{enumerable:!0,get:function(){return v.useSocketIO}});var S=P();Object.defineProperty(r,"ReadyState",{enumerable:!0,get:function(){return S.ReadyState}});var d=Fe();Object.defineProperty(r,"useEventSource",{enumerable:!0,get:function(){return d.useEventSource}});var h=be();Object.defineProperty(r,"resetGlobalState",{enumerable:!0,get:function(){return h.resetGlobalState}})}(oe)),oe}var Ve=Je();const Be=Re(Ve),$e={white:{king:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"45",height:"45",viewBox:"0 0 45 45",children:e.jsxs("g",{fill:"none",fillRule:"evenodd",stroke:"#000",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M22.5 11.63V6M20 8h5",strokeLinejoin:"miter"}),e.jsx("path",{d:"M22.5 25s4.5-7.5 3-10.5c0 0-1-2.5-3-2.5s-3 2.5-3 2.5c-1.5 3 3 10.5 3 10.5",fill:"#fff",strokeLinecap:"butt",strokeLinejoin:"miter"}),e.jsx("path",{d:"M12.5 37c5.5 3.5 14.5 3.5 20 0v-7s9-4.5 6-10.5c-4-6.5-13.5-3.5-16 4V27v-3.5c-2.5-7.5-12-10.5-16-4-3 6 6 10.5 6 10.5v7",fill:"#fff"}),e.jsx("path",{d:"M12.5 30c5.5-3 14.5-3 20 0m-20 3.5c5.5-3 14.5-3 20 0m-20 3.5c5.5-3 14.5-3 20 0"})]})}),queen:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"45",height:"45",viewBox:"0 0 45 45",children:e.jsxs("g",{fill:"#fff",fillRule:"evenodd",stroke:"#000",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M8 12a2 2 0 1 1 4 0 2 2 0 1 1-4 0zM24.5 7.5a2 2 0 1 1-4 0 2 2 0 1 1 4 0zM41 12a2 2 0 1 1-4 0 2 2 0 1 1 4 0zM16 8.5a2 2 0 1 1-4 0 2 2 0 1 1 4 0zM33 9a2 2 0 1 1-4 0 2 2 0 1 1 4 0z"}),e.jsx("path",{d:"M9 26c8.5-1.5 21-1.5 27 0l2-12-7 11V11l-5.5 13.5-3-15-3 15-5.5-14V25L7 14l2 12z",stroke:"#000",strokeLinecap:"butt"}),e.jsx("path",{d:"M9 26c0 2 1.5 2 2.5 4 1 1.5 1 1 .5 3.5-1.5 1-1.5 2.5 0 2.5 1.5 0 1-1 1-1 .5 1 1.5 1 2.5 1s2-1.5 2-1.5c0 .5.5 1.5 1.5 1.5s1-1 .5-2c-.5-1-1-1.5-1-3 0-1.5 1.5-3 1.5-3 0 2.5 2 4 2 4 0-4.5-6.5-1-6.5-5 0-1 1-3 2-3"}),e.jsx("path",{d:"M9 26c0 2 1.5 2 2.5 4 1 1.5 1 1 .5 3.5-1.5 1-1.5 2.5 0 2.5 1.5 0 1-1 1-1 .5 1 1.5 1 2.5 1s2-1.5 2-1.5c0 .5.5 1.5 1.5 1.5s1-1 .5-2c-.5-1-1-1.5-1-3 0-1.5 1.5-3 1.5-3 0 2.5 2 4 2 4 0-4.5-6.5-1-6.5-5 0-1 1-3 2-3"}),e.jsx("path",{d:"M11.5 30c3.5-1 18.5-1 22 0M12 33.5c6-1 15-1 21 0",fill:"none"})]})}),rook:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"45",height:"45",viewBox:"0 0 45 45",children:e.jsxs("g",{fill:"#fff",fillRule:"evenodd",stroke:"#000",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M9 39h27v-3H9v3zM12 36v-4h21v4H12zM11 14V9h4v2h5V9h5v2h5V9h4v5",strokeLinecap:"butt"}),e.jsx("path",{d:"M34 14l-3 3H14l-3-3"}),e.jsx("path",{d:"M31 17v12.5H14V17",strokeLinecap:"butt",strokeLinejoin:"miter"}),e.jsx("path",{d:"M31 29.5l1.5 2.5h-20l1.5-2.5"}),e.jsx("path",{d:"M11 14h23",fill:"none",strokeLinejoin:"miter"})]})}),bishop:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"45",height:"45",viewBox:"0 0 45 45",children:e.jsxs("g",{fill:"#fff",fillRule:"evenodd",stroke:"#000",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsxs("g",{fill:"#fff",strokeLinecap:"butt",children:[e.jsx("path",{d:"M9 36c3.39-.97 10.11.43 13.5-2 3.39 2.43 10.11 1.03 13.5 2 0 0 1.65.54 3 2-.68.97-1.65.99-3 .5-3.39-.97-10.11.46-13.5-1-3.39 1.46-10.11.03-13.5 1-1.35.49-2.32.47-3-.5 1.35-1.46 3-2 3-2z"}),e.jsx("path",{d:"M15 32c2.5 2.5 12.5 2.5 15 0 .5-1.5 0-2 0-2 0-2.5-2.5-4-2.5-4 5.5-1.5 6-11.5-5-15.5-11 4-10.5 14-5 15.5 0 0-2.5 1.5-2.5 4 0 0-.5.5 0 2z"}),e.jsx("path",{d:"M25 8a2.5 2.5 0 1 1-5 0 2.5 2.5 0 1 1 5 0z"})]}),e.jsx("path",{d:"M17.5 26h10M15 30h15m-7.5-14.5v5M20 18h5",strokeLinejoin:"miter"})]})}),knight:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"45",height:"45",viewBox:"0 0 45 45",children:e.jsxs("g",{fill:"none",fillRule:"evenodd",stroke:"#000",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M22 10c10.5 1 16.5 8 16 29H15c0-9 10-6.5 8-21",fill:"#fff"}),e.jsx("path",{d:"M24 18c.38 2.91-5.55 7.37-8 9-3 2-2.82 4.34-5 4-1.042-.94 1.41-3.04 0-3-1 0 .19 1.23-1 2-1 0-4.003 1-4-4 0-2 6-12 6-12s1.89-1.9 2-3.5c-.73-.994-.5-2-.5-3 1-1 3 2.5 3 2.5h2s.78-1.992 2.5-3c1 0 1 3 1 3",fill:"#fff"}),e.jsx("path",{d:"M9.5 25.5a.5.5 0 1 1-1 0 .5.5 0 1 1 1 0z",fill:"#000"}),e.jsx("path",{d:"M14.933 15.75a.5 1.5 30 1 1-.866-.5.5 1.5 30 1 1 .866.5z",fill:"#000",strokeWidth:"1.49997"})]})}),pawn:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"45",height:"45",viewBox:"0 0 45 45",children:e.jsx("path",{d:"M22 9c-2.21 0-4 1.79-4 4 0 .89.29 1.71.78 2.38-1.95 1.12-3.28 3.21-3.28 5.62 0 2.03.94 3.84 2.41 5.03-3 1.06-7.41 5.55-7.41 13.47h23c0-7.92-4.41-12.41-7.41-13.47 1.47-1.19 2.41-3 2.41-5.03 0-2.41-1.33-4.5-3.28-5.62.49-.67.78-1.49.78-2.38 0-2.21-1.79-4-4-4z",fill:"#fff",stroke:"#000",strokeWidth:"1.5",strokeLinecap:"round"})})},black:{king:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"45",height:"45",viewBox:"0 0 45 45",children:e.jsxs("g",{fill:"none",fillRule:"evenodd",stroke:"#000",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M22.5 11.63V6",strokeLinejoin:"miter"}),e.jsx("path",{d:"M22.5 25s4.5-7.5 3-10.5c0 0-1-2.5-3-2.5s-3 2.5-3 2.5c-1.5 3 3 10.5 3 10.5",fill:"#000",strokeLinecap:"butt",strokeLinejoin:"miter"}),e.jsx("path",{d:"M12.5 37c5.5 3.5 14.5 3.5 20 0v-7s9-4.5 6-10.5c-4-6.5-13.5-3.5-16 4V27v-3.5c-2.5-7.5-12-10.5-16-4-3 6 6 10.5 6 10.5v7",fill:"#000"}),e.jsx("path",{d:"M20 8h5",strokeLinejoin:"miter"}),e.jsx("path",{d:"M32 29.5s8.5-4 6.03-9.65C34.15 14 25 18 22.5 24.5v2.1-2.1C20 18 10.85 14 6.97 19.85 4.5 25.5 13 29.5 13 29.5",stroke:"#fff"}),e.jsx("path",{d:"M12.5 30c5.5-3 14.5-3 20 0m-20 3.5c5.5-3 14.5-3 20 0m-20 3.5c5.5-3 14.5-3 20 0",stroke:"#fff"})]})}),queen:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"45",height:"45",viewBox:"0 0 45 45",children:e.jsxs("g",{fill:"#000",fillRule:"evenodd",stroke:"#000",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"6",cy:"12",r:"2.75"}),e.jsx("circle",{cx:"14",cy:"9",r:"2.75"}),e.jsx("circle",{cx:"22.5",cy:"8",r:"2.75"}),e.jsx("circle",{cx:"31",cy:"9",r:"2.75"}),e.jsx("circle",{cx:"39",cy:"12",r:"2.75"}),e.jsx("path",{d:"M9 26c8.5-1.5 21-1.5 27 0l2.5-12.5L31 25l-.3-14.1-5.2 13.6-3-14.5-3 14.5-5.2-13.6L14 25 6.5 13.5 9 26z",strokeLinecap:"butt"}),e.jsx("path",{d:"M9 26c0 2 1.5 2 2.5 4 1 1.5 1 1 .5 3.5-1.5 1-1.5 2.5 0 2.5 1.5 0 1-1 1-1 .5 1 1.5 1 2.5 1s2-1.5 2-1.5c0 .5.5 1.5 1.5 1.5s1-1 .5-2c-.5-1-1-1.5-1-3 0-1.5 1.5-3 1.5-3 0 2.5 2 4 2 4 0-4.5-6.5-1-6.5-5 0-1 1-3 2-3"}),e.jsx("path",{d:"M9 26c0 2 1.5 2 2.5 4 1 1.5 1 1 .5 3.5-1.5 1-1.5 2.5 0 2.5 1.5 0 1-1 1-1 .5 1 1.5 1 2.5 1s2-1.5 2-1.5c0 .5.5 1.5 1.5 1.5s1-1 .5-2c-.5-1-1-1.5-1-3 0-1.5 1.5-3 1.5-3 0 2.5 2 4 2 4 0-4.5-6.5-1-6.5-5 0-1 1-3 2-3"}),e.jsx("path",{d:"M11.5 30c3.5-1 18.5-1 22 0M12 33.5c6-1 15-1 21 0",fill:"none",stroke:"#fff"})]})}),rook:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"45",height:"45",viewBox:"0 0 45 45",children:e.jsxs("g",{fillRule:"evenodd",stroke:"#000",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M9 39h27v-3H9v3zM12.5 32l1.5-2.5h17l1.5 2.5h-20zM12 36v-4h21v4H12z",strokeLinecap:"butt",fill:"#000"}),e.jsx("path",{d:"M14 29.5v-13h17v13H14z",strokeLinecap:"butt",strokeLinejoin:"miter",fill:"#000"}),e.jsx("path",{d:"M14 16.5L11 14h23l-3 2.5H14zM11 14V9h4v2h5V9h5v2h5V9h4v5H11z",strokeLinecap:"butt",fill:"#000"}),e.jsx("path",{d:"M12 35.5h21M13 31.5h19M14 29.5h17M14 16.5h17M11 14h23",fill:"none",stroke:"#fff",strokeWidth:"1",strokeLinejoin:"miter"})]})}),bishop:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"45",height:"45",viewBox:"0 0 45 45",children:e.jsxs("g",{fillRule:"evenodd",stroke:"#000",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsxs("g",{fill:"#000",strokeLinecap:"butt",children:[e.jsx("path",{d:"M9 36c3.39-.97 10.11.43 13.5-2 3.39 2.43 10.11 1.03 13.5 2 0 0 1.65.54 3 2-.68.97-1.65.99-3 .5-3.39-.97-10.11.46-13.5-1-3.39 1.46-10.11.03-13.5 1-1.35.49-2.32.47-3-.5 1.35-1.46 3-2 3-2z"}),e.jsx("path",{d:"M15 32c2.5 2.5 12.5 2.5 15 0 .5-1.5 0-2 0-2 0-2.5-2.5-4-2.5-4 5.5-1.5 6-11.5-5-15.5-11 4-10.5 14-5 15.5 0 0-2.5 1.5-2.5 4 0 0-.5.5 0 2z"}),e.jsx("path",{d:"M25 8a2.5 2.5 0 1 1-5 0 2.5 2.5 0 1 1 5 0z"})]}),e.jsx("path",{d:"M17.5 26h10M15 30h15m-7.5-14.5v5M20 18h5",stroke:"#fff",strokeLinejoin:"miter"})]})}),knight:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"45",height:"45",viewBox:"0 0 45 45",children:e.jsxs("g",{fill:"none",fillRule:"evenodd",stroke:"#000",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M22 10c10.5 1 16.5 8 16 29H15c0-9 10-6.5 8-21",fill:"#000"}),e.jsx("path",{d:"M24 18c.38 2.91-5.55 7.37-8 9-3 2-2.82 4.34-5 4-1.042-.94 1.41-3.04 0-3-1 0 .19 1.23-1 2-1 0-4.003 1-4-4 0-2 6-12 6-12s1.89-1.9 2-3.5c-.73-.994-.5-2-.5-3 1-1 3 2.5 3 2.5h2s.78-1.992 2.5-3c1 0 1 3 1 3",fill:"#000"}),e.jsx("path",{d:"M9.5 25.5a.5.5 0 1 1-1 0 .5.5 0 1 1 1 0z",fill:"#fff",stroke:"#fff"}),e.jsx("path",{d:"M14.933 15.75a.5 1.5 30 1 1-.866-.5.5 1.5 30 1 1 .866.5z",fill:"#fff",stroke:"#fff",strokeWidth:"1.49997"}),e.jsx("path",{d:"M24.55 10.4l-.45 1.45.5.15c3.15 1 5.65 2.49 7.9 6.75S35.75 29.06 35.25 39l-.05.5h2.25l.05-.5c.5-10.06-.88-16.85-3.25-21.34-2.37-4.49-5.79-6.64-9.19-7.16l-.51-.1z",fill:"#fff",stroke:"none"})]})}),pawn:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"45",height:"45",viewBox:"0 0 45 45",children:e.jsx("path",{d:"M22 9c-2.21 0-4 1.79-4 4 0 .89.29 1.71.78 2.38-1.95 1.12-3.28 3.21-3.28 5.62 0 2.03.94 3.84 2.41 5.03-3 1.06-7.41 5.55-7.41 13.47h23c0-7.92-4.41-12.41-7.41-13.47 1.47-1.19 2.41-3 2.41-5.03 0-2.41-1.33-4.5-3.28-5.62.49-.67.78-1.49.78-2.38 0-2.21-1.79-4-4-4z",fill:"#000",stroke:"#000",strokeWidth:"1.5",strokeLinecap:"round"})})}},Ke=({position:r,playerColor:f,selectedPiece:v,onSquareClick:S})=>{if(!r)return e.jsx("div",{className:"flex items-center justify-center h-[300px] bg-gray-800 text-gray-300 text-xl rounded-md",children:"Loading board..."});const d=g=>({p:"pawn",n:"knight",b:"bishop",r:"rook",q:"queen",k:"king"})[g]||g,h=()=>{const g=[],m=["a","b","c","d","e","f","g","h"],u=["8","7","6","5","4","3","2","1"],l=f==="black"?[...m].reverse():m,c=f==="black"?[...u].reverse():u;for(let t=0;t<8;t++)for(let o=0;o<8;o++){const a=l[o],n=c[t],i=`${a}${n}`,b=(o+t)%2===0,s=r[i],y=v===i;g.push(e.jsxs("div",{className:`chess-square cursor-pointer ${b?"bg-gray-600":"bg-gray-800"} ${y?"bg-[rgba(61,211,174,0.3)] ring-2 ring-[#3DD3AE]":""} hover:opacity-90 transition-opacity duration-150`,onClick:()=>S(i),"data-square":i,children:[s&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:e.jsx("div",{className:`w-[90%] h-[90%] flex items-center justify-center ${s.color==="black"?"drop-shadow-[0_0_1px_rgba(255,255,255,0.8)]":""}`,children:$e[s.color][d(s.type)]})}),o===0&&e.jsx("div",{className:"absolute top-1 left-1 text-xs text-[#3DD3AE] font-bold pointer-events-none",children:n}),t===7&&e.jsx("div",{className:"absolute bottom-1 right-1 text-xs text-[#3DD3AE] font-bold pointer-events-none",children:a})]},i))}return g};return e.jsxs("div",{className:"grid grid-cols-8 grid-rows-8 w-full aspect-square border-2 border-[#3DD3AE] rounded-md shadow-lg shadow-[#3DD3AE]/20",children:[e.jsx("style",{children:`
          .chess-square {
            aspect-ratio: 1;
            position: relative;
          }
        `}),h()]})},Qe=({gameMode:r,setGameMode:f,timeControl:v,setTimeControl:S,createGame:d,waitingGames:h,joinGame:g,playerName:m,globalStats:u})=>{const l=[{name:"1+0",time:60,increment:0},{name:"3+0",time:180,increment:0},{name:"3+2",time:180,increment:2},{name:"5+0",time:300,increment:0},{name:"5+3",time:300,increment:3},{name:"10+0",time:600,increment:0},{name:"10+5",time:600,increment:5},{name:"15+10",time:900,increment:10}],c=h.filter(t=>t.hostName!==m);return e.jsxs("div",{className:"max-w-4xl mx-auto p-6 bg-gray-900 rounded-lg shadow-lg border border-gray-800",children:[e.jsx("h2",{className:"text-2xl font-bold text-center mb-6 text-white",children:"Chess Lobby"}),e.jsxs("div",{className:"mb-8 p-4 bg-gray-800 rounded-lg border border-gray-700",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4 text-white",children:"Create a New Game"}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-6 mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-lg mb-2 text-gray-300",children:"Game Mode"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{className:`px-4 py-2 rounded-md transition-colors ${r==="standard"?"bg-[#3DD3AE] text-black font-semibold":"bg-gray-700 text-gray-300 hover:bg-gray-600 border border-gray-600"}`,onClick:()=>f("standard"),children:"Standard Chess"}),e.jsx("button",{className:`px-4 py-2 rounded-md transition-colors ${r==="chess960"?"bg-[#3DD3AE] text-black font-semibold":"bg-gray-700 text-gray-300 hover:bg-gray-600 border border-gray-600"}`,onClick:()=>f("chess960"),children:"Chess960"})]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-lg mb-2 text-gray-300",children:"Time Control"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:l.map(t=>e.jsx("button",{className:`px-3 py-2 rounded-md text-sm transition-colors ${v&&v.name===t.name?"bg-[#3DD3AE] text-black font-semibold":"bg-gray-700 text-gray-300 hover:bg-gray-600 border border-gray-600"}`,onClick:()=>S({...t,name:t.name}),children:t.name},t.name))})]})]}),e.jsx("button",{className:`w-full py-2 rounded-md font-semibold transition-colors ${!r||!v?"bg-gray-700 text-gray-500 cursor-not-allowed":"bg-[#3DD3AE] text-black hover:bg-[#2cb896]"}`,disabled:!r||!v,onClick:d,children:"Create Game"})]}),e.jsxs("div",{className:"mb-8 p-4 bg-gray-800 rounded-lg border border-gray-700",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4 text-white",children:"Join a Game"}),c.length===0?e.jsx("p",{className:"text-gray-400 text-center py-4",children:"No games available to join. Create one!"}):e.jsx("div",{className:"space-y-3",children:c.map(t=>e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-700 rounded-md border border-gray-600",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium text-white",children:t.hostName}),e.jsxs("div",{className:"flex gap-2 text-sm text-gray-300",children:[e.jsx("span",{children:t.mode==="standard"?"Standard":"Chess960"}),e.jsx("span",{children:"•"}),e.jsx("span",{children:t.timeControl.name})]})]}),e.jsx("button",{className:"px-4 py-1.5 bg-[#3DD3AE] text-black font-semibold rounded-md hover:bg-[#2cb896] transition-colors",onClick:()=>g(t.id),children:"Join"})]},t.id))})]}),e.jsxs("div",{className:"p-4 bg-gray-800 rounded-lg border border-gray-700",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4 text-white",children:"Global Stats"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-700 rounded-md border border-gray-600",children:[e.jsx("span",{className:"text-gray-300",children:"Queens Captured:"}),e.jsx("span",{className:"font-bold text-[#3DD3AE]",children:u.capturedQueens})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-700 rounded-md border border-gray-600",children:[e.jsx("span",{className:"text-gray-300",children:"Pawns Captured:"}),e.jsx("span",{className:"font-bold text-[#3DD3AE]",children:u.capturedPawns})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-700 rounded-md border border-gray-600",children:[e.jsx("span",{className:"text-gray-300",children:"Kings Castled:"}),e.jsx("span",{className:"font-bold text-[#3DD3AE]",children:u.castledKings})]})]})]})]})},Ye=({playerName:r,opponentName:f,playerColor:v,timeLeft:S,isPlayerTurn:d,gameStats:h,offerDraw:g,acceptDraw:m,declineDraw:u,resign:l,drawOfferReceived:c})=>{const[t,o]=_.useState(S),[a,n]=_.useState(!1),i=_.useRef(null),b=_.useRef(Date.now()),s=_.useRef(d?v:v==="white"?"black":"white"),y=_.useRef(!!f),w=_.useRef(!!f);_.useEffect(()=>{S&&(o(S),b.current=Date.now())},[S]),_.useEffect(()=>{f&&(y.current=!0,w.current=!0)},[f]),_.useEffect(()=>{s.current=d?v:v==="white"?"black":"white"},[d,v]),_.useEffect(()=>(i.current&&clearInterval(i.current),y.current&&w.current&&(i.current=setInterval(()=>{const p=Date.now(),j=(p-b.current)/1e3;o(T=>{if(!T)return T;const A=s.current,G=Math.max(0,T[A]-j);return b.current=p,G<.1&&T[A]>.1&&A===v&&w.current&&(clearInterval(i.current),setTimeout(()=>l("timeout"),100)),{...T,[A]:G}})},100)),()=>{i.current&&clearInterval(i.current)}),[d,f,v,l]),_.useEffect(()=>{c&&n(!1)},[c]),_.useEffect(()=>()=>{w.current=!1,i.current&&clearInterval(i.current)},[]);const O=p=>{if(p===void 0)return"00:00";const j=Math.ceil(p*10)/10,T=Math.floor(j/60),A=Math.floor(j%60),G=Math.floor(j*10%10);return j<10?`${T.toString().padStart(2,"0")}:${A.toString().padStart(2,"0")}.${G}`:`${T.toString().padStart(2,"0")}:${A.toString().padStart(2,"0")}`},x=()=>{!a&&f&&w.current&&(g(),n(!0))};return e.jsxs("div",{className:"bg-gray-900 p-4 rounded-lg shadow-md shadow-[#3DD3AE]/10 flex flex-col gap-4 mb-4 border border-gray-800",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"text-lg text-white",children:f||"Waiting for opponent..."}),e.jsx("div",{className:`font-mono text-2xl px-3 py-1 rounded ${!d&&f?"bg-[#3DD3AE] text-black font-bold":"bg-gray-800 text-gray-300"}`,children:O(t&&t[v==="white"?"black":"white"])})]}),c&&e.jsxs("div",{className:"bg-gray-800 text-white p-3 rounded-md flex justify-between items-center border border-[#3DD3AE]",children:[e.jsxs("span",{children:[f," offered a draw"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"bg-[#3DD3AE] hover:bg-[#2cb896] text-black font-bold px-3 py-1 rounded",onClick:m,children:"Accept"}),e.jsx("button",{className:"bg-gray-700 hover:bg-gray-600 text-white px-3 py-1 rounded",onClick:u,children:"Decline"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{className:`flex-1 py-2 rounded-md transition-colors ${a||!f?"bg-gray-700 text-gray-400 cursor-not-allowed":"bg-gray-800 text-white hover:bg-gray-700 border border-[#3DD3AE]"}`,onClick:x,disabled:a||!f,children:f?a?"Draw Offered":"Offer Draw":"Waiting for opponent"}),e.jsx("button",{className:`flex-1 py-2 rounded-md transition-colors ${f?"bg-gray-800 text-white hover:bg-gray-700 border border-gray-700 hover:border-red-500":"bg-gray-700 text-gray-400 cursor-not-allowed"}`,onClick:()=>l("resigned"),disabled:!f,children:"Resign"})]}),e.jsxs("div",{className:"bg-gray-800 p-3 rounded-md space-y-2 border border-gray-700",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Queens Captured:"}),e.jsx("span",{className:"font-bold text-[#3DD3AE]",children:h.capturedQueens})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Pawns Captured:"}),e.jsx("span",{className:"font-bold text-[#3DD3AE]",children:h.capturedPawns})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Kings Castled:"}),e.jsx("span",{className:"font-bold text-[#3DD3AE]",children:h.castledKings})]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:`font-mono text-2xl px-3 py-1 rounded ${d&&f?"bg-[#3DD3AE] text-black font-bold":"bg-gray-800 text-gray-300"}`,children:O(t&&t[v])}),e.jsxs("div",{className:"text-lg text-white",children:[r," (",v,")",d&&f&&e.jsx("span",{className:"ml-2 text-[#3DD3AE]",children:"- Your turn"})]})]})]})},Ze=()=>{const[r,f]=_.useState(""),[v,S]=_.useState(!1),[d,h]=_.useState(null),[g,m]=_.useState(null),[u,l]=_.useState(!1),[c,t]=_.useState(null),[o,a]=_.useState(null),[n,i]=_.useState(null),[b,s]=_.useState(null),[y,w]=_.useState([]),[O,x]=_.useState(null),[p,j]=_.useState({capturedQueens:0,capturedPawns:0,castledKings:0}),[T,A]=_.useState({capturedQueens:0,capturedPawns:0,castledKings:0}),[G,z]=_.useState({white:0,black:0}),[C,I]=_.useState(!1),[Y,$]=_.useState(!1),[L,K]=_.useState(null),se="wss://kaddu.lol/chess-ws",{sendJsonMessage:k,lastJsonMessage:M}=Be(se,{onOpen:()=>console.log("WebSocket connection established"),onError:N=>console.error("WebSocket error:",N),shouldReconnect:()=>!0,reconnectAttempts:10,reconnectInterval:3e3}),R=()=>{l(!1),t(null),a(null),i(null),s(null),x(null),$(!1),I(!1),j({capturedQueens:0,capturedPawns:0,castledKings:0}),K(null)};_.useEffect(()=>{if(M){const{type:N,data:E}=M;switch(N){case"waiting_games":w(E.games),E.globalStats&&A(E.globalStats);break;case"game_created":t(E.gameId),i(E.color),a(E.position),z(E.timeControl),l(!0),K(null);break;case"game_joined":t(E.gameId),i(E.color),a(E.position),s(E.opponent),z(E.timeControl),l(!0),I(E.color==="white"),K(null);break;case"opponent_joined":s(E.opponent),E.timeControl&&z(E.timeControl),n==="white"&&I(!0);break;case"move_made":a(E.position),E.timeLeft&&z(E.timeLeft),I(E.nextTurn===n),E.stats&&j(Ie=>({...Ie,...E.stats}));break;case"draw_offered":$(!0);break;case"draw_declined":alert("Draw offer declined");break;case"game_over":K(E.result),(!E.result.toLowerCase().includes("time")||!C)&&alert(`Game over: ${E.result}`),setTimeout(()=>{R(),k({type:"get_waiting_games"})},1e3);break;case"error":console.error("Server error:",E.message),alert(`Error: ${E.message}`);break;default:console.log("Unknown message type:",N)}}},[M,n,k,C]),_.useEffect(()=>{if(v){k({type:"get_waiting_games"});const N=setInterval(()=>{u||k({type:"get_waiting_games"})},5e3);return()=>clearInterval(N)}},[v,k,u]);const te=N=>{N.preventDefault(),r.trim()&&(S(!0),k({type:"register",data:{name:r}}))},Q=()=>{!d||!g||k({type:"create_game",data:{mode:d,timeControl:g,playerName:r}})},H=N=>{k({type:"join_game",data:{gameId:N,playerName:r}})},re=(N,E)=>{!C||L||k({type:"make_move",data:{gameId:c,from:N,to:E,playerColor:n}})},ne=N=>{if(!(!C||L))if(O)O===N||re(O,N),x(null);else{const E=o[N];E&&E.color===n&&x(N)}},F=()=>{L||k({type:"offer_draw",data:{gameId:c,playerColor:n}})},ce=()=>{L||(k({type:"accept_draw",data:{gameId:c,playerColor:n}}),$(!1))},X=()=>{L||(k({type:"decline_draw",data:{gameId:c,playerColor:n}}),$(!1))},Ae=(N="resigned")=>{L||(N==="timeout"||window.confirm("Are you sure you want to resign?"))&&k({type:"resign",data:{gameId:c,playerColor:n}})};return e.jsx("div",{className:"max-w-4xl mx-auto px-4 py-6 text-white",children:v?u?e.jsxs("div",{className:"space-y-4",children:[e.jsx(Ye,{playerName:r,opponentName:b,playerColor:n,timeLeft:G,isPlayerTurn:C,gameStats:p,offerDraw:F,acceptDraw:ce,declineDraw:X,resign:Ae,drawOfferReceived:Y}),e.jsx("div",{className:"max-w-xl mx-auto",children:e.jsx(Ke,{position:o,playerColor:n,selectedPiece:O,onSquareClick:ne})}),L&&e.jsxs("div",{className:"p-3 bg-gray-800 text-white rounded-md text-center border border-[#3DD3AE]",children:[e.jsxs("p",{className:"font-bold",children:["Game Over: ",L]}),e.jsx("button",{className:"mt-2 px-4 py-2 bg-[#3DD3AE] text-black rounded-md hover:bg-[#2cb896]",onClick:R,children:"Return to Lobby"})]})]}):e.jsx(Qe,{gameMode:d,setGameMode:h,timeControl:g,setTimeControl:m,createGame:Q,waitingGames:y,joinGame:H,playerName:r,globalStats:T}):e.jsxs("div",{className:"max-w-md mx-auto p-6 bg-gray-800 rounded-lg shadow-lg",children:[e.jsx("h2",{className:"text-2xl font-bold text-center mb-6",children:"Welcome to Chess"}),e.jsxs("form",{onSubmit:te,className:"space-y-4",children:[e.jsx("input",{type:"text",value:r,onChange:N=>f(N.target.value),placeholder:"Enter your name",className:"w-full p-3 bg-gray-700 border border-gray-600 rounded-md text-white",required:!0}),e.jsx("button",{type:"submit",className:"w-full py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:"Enter"})]})]})})};export{Ze as default};
